<% provide :title, @subject_supports.user_subject.subject_name %>

<div id="subject-show"
  data-show-kickoff="<%= @subject_supports.show_kick_off? %>">
  <div class="row">
    <div class="col-md-9">
      <div class="subject-overview">
        <span class="header-title">
          <%= @subject_supports.user_subject.name %>
        </span>
        <span class="label-status <%= set_background_color_status @subject_supports.user_subject.status %>">
          <%= t "courses.labels.status.#{@subject_supports.user_subject.status}" %>
        </span>
        <% unless @subject_supports.user_subject.finish? || @subject_supports.course.finish? %>
          <div id="dialog-finish" title="<%= t 'user_subjects.finish.confirm-title' %>"
            class="dialog">
            <% if @subject.subject_detail %>
              <p><%= t "user_subjects.finish.confirm_exam" %></p>
              <%= link_to "", user_subject_path(@subject_supports.user_subject),
                method: :put, class: "hidden", id: "finish-subject-exam" %>
            <% else %>
              <p><%= t "user_subjects.finish.confirm_project" %></p>
              <%= link_to "", user_subject_path(@subject_supports.user_subject),
                method: :put, class: "hidden", id: "finish-subject-project" %>
            <% end %>
          </div>
          <% if current_user.trainee? && @subject_supports.user_subject.progress? %>
            <%= link_to t("buttons.finish"), "#",
              class: "btn btn-danger pull-right finish-subject" %>
          <% elsif @subject.subject_detail &&
            @subject_supports.user_subject.waiting? %>
            <% if @subject_supports.exam_process &&
              @subject_supports.exam_process.testing? %>
              <%= link_to t("buttons.continute_do_exam"), @subject_supports.exam_process,
                class: "btn btn-info pull-right" %>
            <% else %>
              <%= link_to t("buttons.do_exam"), "#",
                class: "btn btn-info pull-right do-exam-now" %>
            <% end %>
          <% end %>
        <% end %>

        <div class="description">
          <%= @subject_supports.user_subject.description %>
        </div>
        <div class="box box-primary box-widget collapsed-box">
          <div class="box-header box-content">
            <div class="info-title">
              <div class="label-title"><%= t "subjects.content" %></div>
            </div>
            <div class="box-tools">
              <button type="button" class="btn btn-box-tool" data-widget="collapse"
                id="show-more"><%= t "subjects.show_more"%></button>
            </div>
          </div>
          <div class="box-body">
            <%= @subject_supports.user_subject.content
              .html_safe if @subject_supports.user_subject.content %></div>
        </div>
      </div>

      <div class="user-subjects-charts">
        <%= render "user_subject_charts" %>
      </div>
      <br>

      <div class="render-task">
        <div class="user-task">
          <div class="overview">
            <h1><%= t "subjects.task_overview" %></h1>
            <% if current_user.trainee? && @subject_supports
              .user_subject.progress? && !@subject_supports.course.finish? %>
              <%= link_to "#",
                data: {toggle: "modal", target: "#TaskModal"},
                class: "pull-right btn-new-task", title: t("subjects.title.create") do %>
                <button type="button">
                  <span class="glyphicon glyphicon-plus"></span>
                  <%= t "subjects.task.new_task" %>
                </button>
              <% end %>
            <% end %>
          </div>

          <div class="note-list all-task-list" id="user-task-list">
            <%= render partial: "user_task", collection: @subject_supports.user_tasks %>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 info-panel">
      <%= render "info_panel" %>
    </div>
  </div>
  <%= render "shared/task_modal" %>
  <%= render "shared/member_modal", trainers: @subject_supports.trainers,
    trainees: @subject_supports.trainees %>
  <%= render "project_assignments_modal", project: @subject_supports.project %>
  <%= render "kickoff_modal" %>
</div>
